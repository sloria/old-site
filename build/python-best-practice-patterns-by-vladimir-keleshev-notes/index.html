
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <meta charset="utf-8">
  <title>Steven Loria | Python Best Practice Patterns by Vladimir Keleshev (Notes)</title>
  <meta name="description" content="">
  <meta name="author" content="Steven Loria">



  <link rel="stylesheet" href="/assets/themes/sl/css/base.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="http://yandex.st/highlightjs/7.3/styles/tomorrow-night.min.css">
<script src="http://yandex.st/highlightjs/7.3/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
  <link rel="stylesheet" href="/assets/themes/sl/fontawesome/css/font-awesome.min.css" type='text/css'>
  <link media="only screen and (max-device-width: 480px)" href="/assets/themes/sl/css/iphone.css" type="text/css" rel="stylesheet" />
</head>

<body>
  <section class="sidebar">
    <a href="/">
      <img src="http://www.gravatar.com/avatar/c74f9cfd7776305a82ede0b765d65402.png?s=150" height="100" width="100" class="avatar" />
    </a>

    <section class="name">
      <a href="/">
        <span id="fname">Steven</span>
        <span id="lname">Loria</span>
      </a>
    </section>

    <section class="meta">
      <a href="https://github.com/sloria" target="_blank"><i class="icon-github-alt"></i></a>
      <a href="https://linkedin.com/in/sloria" target="_blank"><i class="icon-linkedin-sign"></i></a>
      <a href="mailto:sloria1@gmail.com}" target="_blank"><i class="icon-envelope-alt"></i></a>
    </section>

    <section class="sections">
      <ul>
        <li><a href="/">about</a></li>
        <li><a href="/projects.html">projects</a></li>
        <li><a href="/archive.html">blog</a></li>
      </ul>
    </section>
  </section>

  
<section class="content">
  <h1>
    <a href="">Python Best Practice Patterns by Vladimir Keleshev (Notes)</a>
  </h1>

  <section class="byline">
    May  9, 2013
  </section>

  <p>These are my notes from Vladimir Keleshev&#8217;s talk entitled &#8220;Python Best Practice Patterns&#8221;, given on May 2, 2013 at the Python Meetup in Denmark. The original video is <a href='http://youtu.be/GZNUfkVIHAY'>here</a> (about 38 minutes long).</p>

<h2 id='composed_method'>Composed method</h2>

<ul>
<li>Divide program into methods that perform one task - Keep <em>all</em> operation in a method at the same level of abstraction</li>

<li>Use many methods only a few lines long</li>
</ul>
<pre><code class='python'># Bad
class Boiler:
    def safety_check(self):
        # Convert fixed-point floating point
        temperature = self.modbus.read_holding()
        pressure_psi = self.abb_f100.register / F100_FACTOR
        if psi_to_pascal(pressure_psi) > MAX_PRESSURE:
            if temperature > MAX_TEMPERATURE:
                # Shutdown!
                self.pnoz.relay[15] &amp;= MASK_POWER_COIL
                self.pnoz.port.write('$PL,15\0')
                sleep(RELAY_RESPONSE_DELAY)
                # Successful shutdown?
                if self.pnoz.relay[16] &amp; MASK_POWER_OFF:
                    # Play alarm
                    with open(BUZZER_MP3_FILE) as f:
                        play_sound(f.read())
</code></pre>
<ul>
<li>Different levels of abstraction: bitmaps, filesystem operations, playing sounds&#8230;</li>
</ul>
<pre><code class='python'># Better
class Boiler:
    def safety_check(self):
        if any([self.temperature > MAX_TEMPERATURE,
                self.pressure > MAX_PRESSURE]):
            if not self.shutdown():
                self.alarm()

    def alarm(self):
        with open(BUZZER_MP3_FILE) as f:
            play_sound(f.read())

    @property
    def pressure(self):
        pressure_psi = abb_f100.reguster / F100_FACTOR
        return psi_to_pascal(pressure_psi)
    ...
</code></pre>
<ul>
<li><code>safety_check</code> deals with temp and pressure</li>

<li><code>alarm</code> deals with files and sound</li>

<li><code>pressure</code> deals with bits and converting them</li>
</ul>

<h2 id='constructor_method'>Constructor method</h2>

<ul>
<li>provide constructors that create well-formed instances - Pass all required parameters to them</li>
</ul>
<pre><code class='python'># Bad
point = Point()
point.x = 12
point.y = 5
</code></pre>
<ul>
<li>At initiation <code>point</code> is not well-formed</li>
</ul>
<pre><code class='python'># Better
point = Point(x=12, y=5)
</code></pre>
<ul>
<li>Can use class methods to make multiple constructors - Example: Using Cartesian or polar coordinates</li>
</ul>
<pre><code class='python'>class Point:
    def __init_(self, x, y):
        self.x, self.y = x, y

    @classmethod
    def polar(class_, r, theta):
        return class_(r * cos(theta),
                        r * sin(theta))

point = Point.polar(r=13, theta-22.6)
</code></pre>
<h2 id='method_objects'>Method objects</h2>

<ul>
<li>How do you code a method where many lines of code share many arguments and temporary variables?</li>
</ul>
<pre><code class='python'>def send_task(self, task, job, obligation):
    ...
    processed = ...
    ...
    copied = ...
    ...
    executed = ...
    100 more lines
</code></pre>
<ul>
<li>Can&#8217;t be solved by making many small methods (would use more code)</li>
</ul>
<pre><code class='python'># Solution
class TaskSender:
    def __init__(self, task, job obligation):
        self.task = task
        self.job = job
        self.obligation = obligation
        self.processed = []
        self.copied = []
        self.executed = []

    def __call__(self):
        self.prepare()
        self.process()
        self.execute()
    ...
</code></pre>
<h2 id='execute_around_method_in_python_context_manager'>Execute around method (in Python: Context manager)</h2>

<ul>
<li>How do you represent pairs of actions that should be taken together?</li>
</ul>
<pre><code class='python'>f = open('file.txt', 'w')
f.write('hi')
f.close()

# Better
with open('file.txt', 'w') as f:
    f.write('hi')   

with pytest.raises(ValueError):
    int('hi')

with SomeProtocol(host, port) as protocol:
    protocol.send(['get', signal])
    result = protocol.receive() 

class SomeProtocol:
    def __init__(self, host, port):
        self.host, self.port = host, port

    def __enter__(self):
        self._client = socket()
        self._client.connect((self.host,
                                self.port))

    def __exit__(self, exception, value, traceback):
        self._client.close()

    def send(self, payload): ...

    def receive(self): ...
</code></pre>
<h2 id='debug_printing_method'>Debug printing method</h2>

<ul>
<li><code>__str__</code> for users - e.g. <code>print(point)</code></li>

<li><code>__repr__</code> for debugging/interactive mode</li>
</ul>

<h2 id='method_comment'>Method comment</h2>

<ul>
<li>small methods can be more effective than comments</li>
</ul>
<pre><code class='python'># Meh
if self.flags &amp; 0b1000:  # Am I visible?
    ...

# Better
...
@property
def is_visible(self):
    return self.flags &amp; 0b1000

if self.is_visible:
    ...
</code></pre>
<h2 id='choosing_message'>Choosing message</h2>
<pre><code class='python'># Bad
if type(entry) is Film:
    responsible = entry.producer
else:
    responsible = entry.author
</code></pre>
<ul>
<li>Shouldn&#8217;t use type() or instanceof() in conditional &#8211;&gt; smelly</li>
</ul>
<pre><code class='python'># Better
class Film:
    ...
    @property
    def responsible(self):
        return self.producer

entry.responsible
</code></pre>
<h2 id='intention_revealing_message'>Intention revealing message</h2>

<ul>
<li>How do you communicate your intent when implementation is simple?</li>

<li>Use for methods that do the same thing (for readability)</li>
</ul>
<pre><code class='python'># Meh
class ParagraphEditor:
    ...
    def highlight(self, rectangle):
        self.reverse(rectangle)

# Better
class ParagraphEditor:
    ...
    highlight = reverse  # More readable, more composable
</code></pre>
<h2 id='constant_method_constant_class_variable'>Constant method (constant class variable)</h2>
<pre><code class='python'># Bad
_DEFAULT_PORT = 1234

class SomeProtocol:
    ...
    def __enter__(self):
        self._client = socket()
        self._client.connect(
            (self.host,
            self.port or _DEFAULT_PORT)
        )
        return self  
</code></pre>
<ul>
<li>If you want to subclass SomeProtocol, you would have to overwrite very method!</li>
</ul>
<pre><code class='python'># Better
class SomeProtocol:
    _default_port = 1234
    ...
    def __enter__(self):
        self._client = socket()
        self._client.connect(
            (self.host,
            self.port or self._default_port))
</code></pre>
<ul>
<li>Depends if you are designing to make your class subclassable</li>
</ul>

<h2 id='direct_and_indirect_variable_access'>Direct and indirect variable access</h2>

<ul>
<li>Direct - no need for getters and setters</li>
</ul>
<pre><code class='python'>
class Point:
    def __init__(self, x, y):
        self.x, self.y = x, y
</code></pre>
<ul>
<li>Sometimes need more flexibility &#8211;&gt; use properties</li>
</ul>
<pre><code class='python'>
class Point:
    def __init__(self, x, y):
        self._x, self._y = x, y

    @property
    def x(self):
        return self._x

    @x.setter
    def x(self, value):
        self._x = value
</code></pre>
<h2 id='enumeration_iteration_method'>Enumeration (iteration) method</h2>
<pre><code class='python'># Bad
class Department:
    def __init__(self, *employees):
        self.employees = employees

for employee in department.employees:
    ...
</code></pre>
<ul>
<li>Can&#8217;t change type of collection - e.g. can&#8217;t change employees from a list to a set</li>
</ul>
<pre><code class='python'># Better
class Department:
    def __init__(self, *employees):
        self._employees = employees

    def __iter__(self):
        return iter(self._employees)

for employee in department:  # More readable, more composable
    ...
</code></pre>
<h2 id='temporary_variable'>Temporary variable</h2>
<pre><code class='python'># Meh
class Rectangle:
    def bottom_right(self):
        return Point(self.left + self.width,
                    self.top + self.height)

# Better to use temporary variables for readability
class Rectangle:
    ...
    def bottom_right(self):
        right = self.left + self.width
        bottom = self.top + self.height
        return Point(right, bottom)
</code></pre>
<h2 id='sets'>Sets</h2>

<ul>
<li>Can often use sets instead of combination of for loops</li>
</ul>
<pre><code>Set
---

item in a_set
item not in a_set

a_set &lt;= other
a_set.is_subset(other)

a_set | other
a_set.union(other)

a_set &amp; other
a_set.intersection(other)

a_set - other
a_set.difference(other)
</code></pre>
<h2 id='equality_method'>Equality method</h2>
<pre><code class='python'>
obj == obj2
obj1 is obj2

class Book:
    ...
    def __eq__(self, other):
        if not isinstance(other, self.__class__):
            return False
        return (self.author == other.author and 
                self.title == other.title)
</code></pre>
<ul>
<li>Probably the only case to check <code>isinstance()</code></li>
</ul>

<h2 id='hashing_method'>Hashing method</h2>
<pre><code class='python'>class Book:
    ...
    def __hash__(self):
        return hash(self.author) ^ hash(self.other)
</code></pre>
<h2 id='sorted_collection'>Sorted collection</h2>
<pre><code class='python'>class Book:
    ...
    def __lt__(self):
        return (self.author &lt; self.author and
                self.title &lt; self.title)    
</code></pre>
<h2 id='concatenation'>Concatenation</h2>
<pre><code class='python'>class Config:
    def __init__(self, **entries):
        self.entries = entries

    def __add__(self, other):
        entries = (self.entries.items() + 
                    other.entries.items())
        return Config(**entries)
default_config = Config(color=False, port=8080)
config = default_config + Config(color=True)
</code></pre>
<h2 id='simple_enumeration_parameter'>Simple enumeration parameter</h2>

<ul>
<li>When you can&#8217;t come up with an iteration param that makes sense, just use <code>each</code></li>
</ul>
<pre><code class='python'># Awkward
for options_shortcut in self.options_shortcuts:
    options_shortcut.this()
    options_shortcut.that()

# Better
for each in self.options_shortcuts:
    each.this()
    each.that()    
</code></pre>
<h2 id='cascades'>Cascades</h2>

<ul>
<li>Instead of writing methods without return values, make them return self - allows cascading of methods</li>
</ul>
<pre><code class='python'># Instead of this
self.release_water()
self.shutdown()
self.alarm()

class Reactor:
    ...
    def release_water(self):
        self.valve.open()
        return self

self.release_water().shutdown().alarm()    
</code></pre>
<h2 id='interesting_return_value'>Interesting return value</h2>
<pre><code class='python'># Meh
def match(self, items):
    for each in enumerate(items):
        if each.match(self):
            return each
</code></pre>
<ul>
<li>Is this supposed to reach the end? Is this a bug?</li>
</ul>
<pre><code class='python'># Better
def match(self, items):
    for each in enumerate(items):
        if each.match(self):
            reutnr each
    return None
</code></pre>
<ul>
<li>Explicit better than implicit</li>

<li>Include return value if it&#8217;s interesting (even if it&#8217;s <code>None</code>)</li>
</ul>

<h3 id='further_reading'>Further reading</h3>

<ul>
<li><a href='http://www.amazon.com/Smalltalk-Best-Practice-Patterns-ebook/dp/B00BBDLIME/ref=dp_kinw_strp_1'>Smalltalk Best Practice Patterns</a> - Not for Smalltalk: applicable to Python, Ruby, and many other languages</li>
</ul>

<hr>

  <section class="meta">
<p>Please send comments by <a href="mailto:sloria1@gmail.com">email</a>. I welcome your feedback, advice, and criticism.</p>
    <h3>Recent</h3>
    <ul class="listing">
      
      <li>
        <span>June 30, 2013</span> <a href="/lazy-evaluated-properties-in-python">Lazily-evaluated property pattern in Python</a>
      </li>
      
      <li>
        <span>May 29, 2013</span> <a href="/disillusionment-in-startups-collected-quotes">Startup Skepticism::Collected quotes of disillusionment about the startup system</a>
      </li>
      
      <li>
        <span>May  9, 2013</span> <a href="/python-best-practice-patterns-by-vladimir-keleshev-notes">Python Best Practice Patterns by Vladimir Keleshev (Notes)</a>
      </li>
      
      <li>
        <span>April 15, 2013</span> <a href="/the-ideas-file">The .ideas file</a>
      </li>
      
      <li>
        <span>March 28, 2013</span> <a href="/microprojects">Microprojects</a>
      </li>
      
      <li>
        <span>March 24, 2013</span> <a href="/a-professional-reinvents-himself">A professional reinvents himself - Steven Pressfield</a>
      </li>
      
      <li>
        <span>March 23, 2013</span> <a href="/my-mooc-education-2013">My MOOC education 2013 (Updated May 26, 2013)</a>
      </li>
      
    </ul>
  </section>
</section>


<footer>
  <small>
  <ul class="company">
    <li>&copy; Steven Loria 2013</li>
  </ul>
  </small>
</footer>
  


  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-39544608-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



</body>

</html>

